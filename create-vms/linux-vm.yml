---
- name: Create Linux Router VM
  hosts: all
  gather_facts: no
  become: yes
  tasks:
    - name: Gather facts
      setup:

    - name: Check if OS is Debian
      fail:
        msg: "This playbook can only be run on Debian. Exiting."
      when: ansible_distribution != 'Debian'

    - name: Ensure VM is present
      virt:
        name: linux_router_vm
        memory: 2048
        vcpus: 2
        virt_type: kvm
        os_variant: generic
        state: running
        disk:
          size: 20G
          format: qcow2
          path: /vmfs/linux_router_vm.qcow2
        network:
          - name: default
          - name: private_network
        graphics: none
        cdrom: /vmfs/ISO/debian.iso

